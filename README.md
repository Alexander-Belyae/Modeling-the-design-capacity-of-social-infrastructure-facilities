# Разработка метода моделирования проектной мощности объектов социальной инфраструктуры на основе пространственно-морфологического анализа геоданых с применением машинного обучения


## Описание
Данный репозиторий создан в рамках ВКР **"Разработка метода моделирования проектной мощности объектов социальной инфраструктуры на основе пространственно-морфологического анализа глоданых с применением машинного обучения"** по направлению подготовки 07.04.04 Градостроительство. В нем представлены ключевые реализации методов пространственного анализа данных, необходимых для оценки гипотез по преобразованию территорий. 
Для исследования и валидации метода была использованы датасеты школ Санкт-Петербурга и Москвы с их проектной мощностью. 

**Целью** данного исследования является разработке метода позволяющего восполнять данные о проектной мощности объектов социальной инфраструктуры. 
Для достижения этой цели необходимо выполнение следующих задач.

**Задачи**:
- поиск, последующий анализ и классификация существующих методов и моделей позволяющих восполнять данные об объектах;
- разработать собственный метод с использованием наиболее подходящих для этого моделей;
- описать метод и его механизм работы;
- выгрузить и подготовить данные для проведения апробации метода;
- сформулировать и обосновать перечень необходимых и возможных сценариев;
- проверить разработанный метод на сценарных и реальных данных;
- внедрить разработанный метод:
 
## Основные библиотеки
- **pandas**: обработка и анализ табличных данных.
- **osmnx**: работа с графами дорожной сети, включая получение данных с OpenStreetMap.
- **geopandas**: обработка геопространственных данных.
- **matplotlib**: визуализация данных.
- **scikit-learn**: используется для подготовки и оценки моделей машинного обучения: разбиение данных на обучающую и тестовую выборки (train_test_split), кросс-валидация (cross_val_score), метрика RMSE (mean_squared_error), а также сами алгоритмы ансамблевой регрессии — RandomForestRegressor, GradientBoostingRegressor и объединение моделей через VotingRegressor.
- **catboost**: здесь применяется CatBoostRegressor для градиентного бустинга, особенно эффективно обрабатывающего категориальные признаки «из коробки». В коде вы настраиваете число итераций, скорость обучения и глубину деревьев, а затем обучаете модель на ваших геометрических фичах.
- **optuna**: фреймворк для автоматической оптимизации гиперпараметров. В функции optimize_xgboost_with_optuna вы создаёте study, определяете поисковое пространство для XGBRegressor (число деревьев, глубину, скорость обучения, параметры регуляризации и т.д.) и запускаете 50 испытаний, после чего строите оптимальный экземпляр модели.
- **numpy**: базовая библиотека для численных операций: вычисление констант (np.pi), векторных расчётов (np.linalg.norm), элементных операций над массивами (расчёт компактности, координат центроидов, соотношений площадей и периметров, расстояний и т.п.).
- **seaborn**: используется в функции plot_feature_importance поверх Matplotlib для удобного и читаемого построения горизонтальных столбчатых графиков важности признаков (sns.barplot).
- **lightgbm**: модель градиентного бустинга LGBMRegressor от Microsoft, настроенная аналогично CatBoost (число итераций, скорость обучения, глубина), для включения в итоговый ансамбль.
- **shap**: инструмент для объяснения предсказаний моделей через Shapley-значения. Вы импортируете shap, чтобы в дальнейшем оценивать вклад каждого признака в предсказания (например, через shap.TreeExplainer и shap.summary_plot).
- **joblib**: применяется для сериализации/десериализации (функция save_model) обученных моделей, а также предоставляет простой интерфейс для параллельных вычислений в задачах, где это необходимо.

## Основные методы

### 1. Получение пространственных данных
1. Выгрузка из OSM слоев с административно-территориальным делением:
- для МО (слой city): границы города, название (Name), численность населения (Population);
- для районов (слой district): границы районов, название (Name), численность населения (Population).
2. Заполнение атрибута Population по данным Росстат на 2023 год.
3. Выгрузка геометрии всех зданий, слой building:
  addr:city - город
  addr:region - регион
  addr:street - улица
  addr:housenumber – номер дома.
  * В случае нехватки актуальных данных - дорисовать геометрию и заполнить атрибуты вручную.
4. Получение координат жилых домов из реестра, сопоставить их с выгруженной ранее геометрией, добавить и заполнить атрибут is_living исходя из того, что
‘0’ – нежилой, ‘1’ – жилой.
5. Заполнение этажности жилых домов (level).
6. Восполнение населения.
7. Выгрузка сервисов в виде центроидов, если не указано иное:
- базовой инфраструктуры;
- социальной инфраструктуры;
- транспортной инфраструктуры;
- инфраструктуры обслуживания населения;
- инфраструктуры досуга;
- туристической инфраструктуры;
8. Заполнить вместимость школ и детских садов.
9. Нарезка кварталов с помощью библиотеки **blocksnet**.

**get_drive_graph**: получение графа транспортной сети для автомобилей.
- **get_walk_graph**: создание графа пешеходной инфраструктуры.
- **get_all_public_transport_graph**: сбор данных об общественном транспорте.
- **get_boundary**: определение границ изучаемой территории.

### 2. Центральность и сводные показатели
- **Centrality**: определение центральных узлов сети и ключевых путей.
- **Connectivity**: анализ связности территорий.

### 3. Доступность
- **AccessibilityProcessor**: инструменты для оценки доступности различных объектов и услуг на территории.
- **Accessibility**: пространственный анализ доступности ключевых объектов.

### 4. Обеспеченность
- **Provision** и **ProvisionMethod**: анализ плотности объектов, таких как школы, больницы и магазины, и их обеспеченности.

### 5. Прогнозирование
- **LandUsePrediction**: прогноз изменения использования земельных участков.
- **Diversity**: оценка разнообразия объектов на территории.

### 6. Визуализация
- Построение картографических визуализаций с использованием **matplotlib**, **geopandas** и **rTIM**.
Гипотеза 1:
![screenshot_before](docs/hyp1/1.1.png)
![screenshot_before](docs/hyp1/2.1.png)

## Структура репозитория
- **Jupyter Notebook**: основной файл с кодом для выполнения анализа.
- **Данные**: входные и выходные данные, включая географические границы, графы сетей и сервисы с процессом их отбора.
- **Документы**: нулевая гипотеза и гипотезы развития территории, их визуализация, а также сама модель
- **README**: описание репозитория и методов.

## Использование
1. Установите зависимости из `requirements.txt`.
2. Откройте Jupyter Notebook для выполнения анализа.
3. Следуйте инструкциям в ноутбуке для запуска анализа вашей территории.

## Авторы и вклад
Исследование проведено междисциплинарной командой цифровых урбанистов разного профиля.
- Беляев Александр Владимирович
  
## Лицензия
Данный проект распространяется под свободной лицензией. Используйте материалы в образовательных и исследовательских целях.
